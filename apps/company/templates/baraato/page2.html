{% extends 'baraato/base.html' %}
{% load static %}


{% block part_2_time %}
	active
{% endblock %}

{# main #}
{% block main %}
    	<div class="part-2-main">
            <div class="text-main">
                <div class="text">زمان‌های در دسترس برای {{ company.name}}</div>
                <div class="text">لطفاً برای رزرو یک مورد را انتخاب کنید</div>
                <div class="text">برای تغییر ماه روی فلش کلیک کنید</div>
                
                {# date #}
                <div class="date">
                    <label style="display: flex; flex-direction: column">
                        {#TODO : Add data-jdp-max-date#}
                        <input id="test" data-jdp-miladi-input="miladi_date" data-jdp placeholder="انتخاب تاریخ" data-jdp-min-date="today">
                        <input id="miladi_date" />
                    </label>
                    <br>
                    <div id="time"></div>
                </div>
                
                <div class="div">
                    <div class="divar"></div>
                    <div class="parent-btn-page2">
                        <button class="button-green"><a href="{% url 'company:list-company' %}">بازگشت</a></button>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}


{# js #}
{% block script %}
    {#  add files  Date conversion #}
    {#https://github.com/senior-x-79/farvardin.js#}
    <script src="{% static 'date-conversion/farvardin.min.js' %}"></script>
<script>
    {# push data in list #}
    let lis = []
            {% for holiday in holidays %}
                lis.push(farvardin.gregorianToSolar({{holiday.date.year}} , {{holiday.date.month}} , {{holiday.date.day}} , "object"))
            {% endfor %}
   
    jalaliDatepicker.updateOptions({
        dayRendering:function(dayOptions,input){
            for (let i = 0; i < lis.length; i++) {
                    if (dayOptions.year === lis[i].year && dayOptions.month === lis[i].month && dayOptions.day === lis[i].day)
                        return{
                            isValid:false
                        }
            }   
      }
    });
    
    {# Calculate hours #}
        function getTime(startTime, endTime, duration) {
            let start = new Date(`1970-01-01T${startTime}`);
            let end = new Date(`1970-01-01T${endTime}`);
            let result = [];
        
            let durationInMs = duration * 1000 * 60;
        
            while (start <= end) {
                let hours = start.getHours().toString().padStart(2, '0');
                let minutes = start.getMinutes().toString().padStart(2, '0');
                let seconds = start.getSeconds().toString().padStart(2, '0');
                result.push(`${hours}:${minutes}:${seconds}`);
        
                start = new Date(start.getTime() + durationInMs);
            }
        
            return result;
        }
    
    {# date conversion #}
    
    document.querySelector("[data-jdp-miladi-input]").addEventListener("jdp:change", function (e) {
        let miladiInput = document.getElementById(this.getAttribute("data-jdp-miladi-input"));
        if (!this.value) {
            miladiInput.value = "";
            return;
        }
        
        let date = this.value.split("/");
        
        {#document.getElementById('time-new').innerHTML = date#}
        
        miladiInput.value = farvardin.solarToGregorian(Number(date[0]), Number(date[1]), Number(date[2]), "array")
        
        {# Time  #}
        let timeslots = getTime('{{ sansConfig.first.start_time|time:"H:i:s" }}',
            '{{ sansConfig.first.end_time|time:"H:i:s" }}',
            30);
        
        let time = document.getElementById('time')
        {#for (let i = 0; i < timeslots.length; ++i) {#}
        {#    let li = document.createElement('li');#}
        {#    li.innerText = timeslots[i];#}
        {#    time.appendChild(li);#}
        {# } #}
        for (let i = 0; i < timeslots.length; ++i) {
                let div = document.createElement('div');
                let input = document.createElement('input');
                input.className = 'form-check-input';
                input.type = 'radio';
                input.name = 'flexRadioDefault';
                input.id = `flexRadioDefault${i}`;

                let label = document.createElement('label');
                label.className = 'form-check-label';
                label.htmlFor = `flexRadioDefault${i}`;
                label.innerText = timeslots[i];

                div.appendChild(input);
                div.appendChild(label);
                time.appendChild(div);
            }
        
     });
    
        let list_time = []
        let start_time = '{{ sansConfig.first.start_time|time:"H:i:s" }}'
        var end_time = {{ sansConfig.first.end_time.hour }}
        
</script>
{% endblock %}